<app-details-candidate-global-styles></app-details-candidate-global-styles>

<header #header
        (click)="toggle()"
        [class.maximised]="isMaximised">

  <div class="header-upperPart">
    <div *ngIf="isMaximised"
         @appearHorisontally
         class="header-tools">
      <mat-icon class="candidate-expand">expand_less</mat-icon>
    </div>
    <div class="header-titles">
      <h2>
        {{ givenName }} {{ surname }}
      </h2>
      <div class="numberAndParty">
        <span class="party">
          <mat-icon class="party-{{ partyName | toClassName }}">flag</mat-icon>
          {{ partyAbbreviation }}
        </span>
        <span class="number">
          {{ candidate.number }}
        </span>
      </div>
    </div>
    <div class="header-tools">
      <div *ngIf="!voterDisabled"
            class="score">
        {{ candidate.score | percent }}
      </div>
      <mat-icon *ngIf="isFavourite == false"
                (click)="setFavourite(true, $event)"
                title="Lisää muistilistalle"
                aria-label="Lisää muistilistalle -ikoni"
                class="candidate-favourite candidate-favourite--isNotFavourite">star_border</mat-icon>
      <mat-icon *ngIf="isFavourite == true"
                (click)="setFavourite(false, $event)"
                title="Poista muistilistalta"
                aria-label="Poista muistilistalta -ikoni"
                class="candidate-favourite candidate-favourite--isFavourite">star</mat-icon>
    </div>
  </div>
</header>

<section *ngIf="detailsLoaded"
         class="candidate-content">
  
  <!----------------------------------------------
      BASIC INFORMATION
  ------------------------------------------------>

    <section class="candidate-data candidate-data--primary">

      <div *ngIf="candidate.missing"
           class="candidate-datum missingWarning {{ dataContentClass }}">
        <mat-icon>warning</mat-icon> 
        Ehdokas ei ole vastannut Kielivaalikoneen kysymyksiin
      </div>

      <!-- <ng-container *ngIf="!candidate.missing && !usePortrait">
  
        <div class="candidate-datum">

          <ng-container *ngIf="voterDisabled">

            <label>Vaalilupaukseni kansalliskieliin liittyen</label>

            <div *ngIf="electionPromise; else noPromise"
                  class="electionPromise">
              {{ electionPromise }}
            </div>
            <ng-template #noPromise>
              <div class="secondary">Ei vastausta</div>
            </ng-template>
    
          </ng-container>
    
          <ng-container *ngIf="!voterDisabled">
    
            <ng-container *ngIf="opinions.disagreed.length > 0">
              <label>Merkittävästi eri mieltä {{ opinions.disagreed.length }} kysymyksestä</label>
              <div class="topicChipList topicChipList-disagreementSummary">
                <div *ngFor="let question of opinions.disagreed"
                    (click)="maximiseAndGoToQuestion('answer-' + question.id)"
                    class="topicChip customChip category-{{ question.categoryName | toClassName }}">
                  {{ question.topic }}
                </div>
              </div>
            </ng-container>
      
            <ng-container *ngIf="opinions.disagreed.length == 0">
              <label>Ei kysymyksiä, joista olette merkittävästi eri mieltä</label>
            </ng-container>

          </ng-container>

        </div>

      </ng-container> -->

      <div class="candidate-datum">
        <label>Ikä ja sukupuoli</label>
        <div>
          <span [class]="getContentClasses('age')">
            {{ age }}
          </span> • 
          <span [class]="getContentClasses('gender')">
            {{ gender }}
          </span>
        </div>
      </div>
      <div class="candidate-datum">
        <label>Äidinkieli</label>
        <div [class]="getContentClasses('motherTongue')">
          {{ motherTongue | lcFirst }}
        </div>
      </div>
      <div class="candidate-datum">
        <label>Kielitaito</label>
        <div [class]="getContentClasses('languageSkills')">
          {{ languageSkills | lcFirst }}
        </div>
      </div>
      <div class="candidate-datum">
        <label>Ammatti tai arvo</label>
        <div [class]="getContentClasses('occupation')">
          {{ occupation | lcFirst }}
        </div>
      </div>
      <div class="candidate-datum">
        <label>Koulutus</label>
        <div [class]="getContentClasses('education')">
          {{ education | lcFirst }}
        </div>
      </div>
      <div class="candidate-datum">
        <label>Puolue</label>
        <div [class]="getContentClasses('party')">
          {{ party.name }}
        </div>
      </div>
      <div class="candidate-datum">
        <label>Ehdokasnumero</label>
        <div [class]="getContentClasses('number')">
          {{ number }}
        </div>
      </div>
      <div class="candidate-datum">
        <label>Vaalipiiri</label>
        <div [class]="getContentClasses('constituency')">
          {{ constituency }}
        </div>
      </div>
      <div *ngIf="hasUrls"
           class="candidate-datum candidate-datum-socialMedia">
        <label>Muualla verkossa</label>
        <div [class]="getContentClasses('hasUrls')">

          <ng-container *ngIf="campaignUrl && isLink(campaignUrl)">
            <a [href]="campaignUrl"
               target="_blank">
              Kampanjasivusto
            </a>
          </ng-container>
          <ng-container *ngIf="campaignUrl && !isLink(campaignUrl)">
            Kampanjasivusto: {{ campaignUrl }}
          </ng-container>

          <ng-container *ngIf="facebook && isLink(facebook)">
            <a [href]="facebook"
               target="_blank">
              Facebook
            </a>
          </ng-container>
          <ng-container *ngIf="facebook && !isLink(facebook)">
            FB: {{ facebook }}
          </ng-container>

          <ng-container *ngIf="instagram && isLink(instagram)">
            <a [href]="instagram"
               target="_blank">
              Instagram
            </a>
          </ng-container>
          <ng-container *ngIf="instagram && !isLink(instagram)">
            IG: {{ instagram }}
          </ng-container>

          <ng-container *ngIf="twitter && isLink(twitter)">
            <a [href]="twitter"
               target="_blank">
              Twitter
            </a>
          </ng-container>
          <ng-container *ngIf="twitter && !isLink(twitter)">
            TW: {{ twitter }}
          </ng-container>

          <ng-container *ngIf="otherSocialMedia && isLink(otherSocialMedia)">
            <a [href]="otherSocialMedia"
               target="_blank">
              {{ otherSocialMedia }}
            </a>
          </ng-container>
          <ng-container *ngIf="otherSocialMedia && !isLink(otherSocialMedia)">
            {{ otherSocialMedia }}
          </ng-container>

        </div>
      </div>
      <img class="candidate-portrait" 
           [src]="portraitUrl"
           appFallbackImage />
    </section>

  <!----------------------------------------------
    CAMPAIGN PROMISE
  ------------------------------------------------>

    <section class="candidate-data candidate-data--promise">
      <div class="candidate-datum">
        <label>Vaalilupaus kansalliskieliin liittyen</label>
        <div [class]="getContentClasses('electionPromise')">
          {{ electionPromise }}
        </div>
      </div>
    </section>

  <!----------------------------------------------
    OPINIONS
  ------------------------------------------------>

    <section class="candidate-data candidate-data--opinions">

      <div class="candidate-opinions-wrapper">

        <ng-container *ngIf="voterDisabled">

          <!----------------------------------------------
            ALL QUESTIONS IF VOTER DISABLED
          ------------------------------------------------>

          <ng-container *ngFor="let question of opinions.all">
            <app-candidate-answer [attr.id]="'answer-' + question.id"
                                  [question]="question"
                                  [voterAnswer]="getVoterAnswer(question)"
                                  [candidateAnswer]="getNumericAnswer(question)"
                                  [candidateAnswerOpen]="getRelated(question)"
                                  [partyName]="partyName"
                                  [partyAnswer]="getPartyAverage(question)"></app-candidate-answer>
          </ng-container>

        </ng-container>

        <ng-container *ngIf="!voterDisabled">

          <!----------------------------------------------
            DISAGREED
          ------------------------------------------------>

          <app-custom-expander #expanderDisagreed
                              class="candidate-opinions-disagreed">
            <app-custom-expander-title>
              <span>Merkittävästi eri mieltä kanssasi</span>
            </app-custom-expander-title>
            <app-custom-expander-subtitle>
              <div class="topicChipList">
                <div *ngFor="let question of excerpts.disagreed"
                    (click)="expanderDisagreed.expandAndScrollTo('answer-' + question.id, $event)"
                    class="topicChip customChip category-{{ question.categoryName | toClassName }}">
                  {{ question.topic }}
                </div>
                <span *ngIf="excerptMores.disagreed"
                      class="candidate-opinions-moreTopics">
                  + {{ excerptMores.disagreed }} muuta
                </span>
                <span *ngIf="opinions.disagreed.length == 0"
                      class="candidate-opinions-noTopics">
                  Ei kysymyksiä, joista olette merkittävästi eri mieltä
                </span>
              </div>
            </app-custom-expander-subtitle>
            <ng-container *ngFor="let question of opinions.disagreed">
              <app-candidate-answer [attr.id]="'answer-' + question.id"
                                    [question]="question"
                                    [voterAnswer]="getVoterAnswer(question)"
                                    [candidateAnswer]="getNumericAnswer(question)"
                                    [candidateAnswerOpen]="getRelated(question)"
                                    [partyName]="partyName"
                                    [partyAnswer]="getPartyAverage(question)"></app-candidate-answer>
            </ng-container>
          </app-custom-expander>

          <!----------------------------------------------
            AGREED
          ------------------------------------------------>

          <app-custom-expander #expanderAgreed
                              class="candidate-opinions-agreed">
            <app-custom-expander-title>
              <span>Samaa tai lähes samaa mieltä kanssasi</span>
            </app-custom-expander-title>
            <app-custom-expander-subtitle>
              <div class="topicChipList">
                <div *ngFor="let question of excerpts.agreed"
                    (click)="expanderAgreed.expandAndScrollTo('answer-' + question.id, $event)"
                    class="topicChip customChip category-{{ question.categoryName | toClassName }}">
                  {{ question.topic }}
                </div>
                <span *ngIf="excerptMores.agreed"
                      class="candidate-opinions-moreTopics">
                  + {{ excerptMores.agreed }} muuta
                </span>
                <span *ngIf="opinions.agreed.length == 0"
                      class="candidate-opinions-noTopics">
                  Ei kysymyksiä, joista olette samaa tai lähes samaa mieltä
                </span>
              </div>
            </app-custom-expander-subtitle>
            <ng-container  *ngFor="let question of opinions.agreed">
              <app-candidate-answer [attr.id]="'answer-' + question.id"
                                    [question]="question"
                                    [voterAnswer]="getVoterAnswer(question)"
                                    [candidateAnswer]="getNumericAnswer(question)"
                                    [candidateAnswerOpen]="getRelated(question)"
                                    [partyName]="partyName"
                                    [partyAnswer]="getPartyAverage(question)"></app-candidate-answer>
            </ng-container>
          </app-custom-expander>

          <!----------------------------------------------
            UNANSWERED
          ------------------------------------------------>

          <app-custom-expander #expanderUnanswered
                              class="candidate-opinions-unanswered">
            <app-custom-expander-title>
              <span>Mielipiteet kysymyksiin, joihin et vielä ole vastannut</span>
            </app-custom-expander-title>
            <app-custom-expander-subtitle>
              <span *ngIf="opinions.unanswered.length != 0"
                    class="candidate-opinions-moreTopics">
                {{ opinions.unanswered.length }} kysymystä
              </span>
              <span *ngIf="opinions.unanswered.length == 0"
                    class="candidate-opinions-noTopics">
                Ei kysymyksiä, joihin et olisi vastannut
              </span>

            </app-custom-expander-subtitle>
            <ng-container  *ngFor="let question of opinions.unanswered">

              <app-candidate-answer [attr.id]="'answer-' + question.id"
                                    [question]="question"
                                    [candidateAnswer]="getNumericAnswer(question)"
                                    [candidateAnswerOpen]="getRelated(question)"
                                    [partyName]="partyName"
                                    [partyAnswer]="getPartyAverage(question)"></app-candidate-answer>
            </ng-container>
          </app-custom-expander>

        </ng-container>

      </div>

    </section>

</section>


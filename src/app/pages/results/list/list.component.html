<cdk-virtual-scroll-viewport [itemSize]="itemHeight + itemMargin"
                            minBufferPx="1200" 
                            maxBufferPx="1800">

    <ng-container *cdkVirtualFor="let candidate of visibleCandidates; let index = index">

      <!-- We might have up to two placeholder divs up front -->
      
      <ng-container *ngIf="candidate.placeholderType">

        <div *ngIf="candidate.placeholderType == 'empty'"
            class="candidateEmpty"></div>

        <div *ngIf="candidate.placeholderType == 'intro'"
            class="introMessage"
            [style.maxWidth]="cardWidth"
            [style.marginLeft]="marginLeft">
            <ng-container i18n>Tässä ovat vaalipiirisi ehdokkaat, jotka ovat vastanneet Kielivaalikoneen kysymyksiin.
          Voit halutessasi suodattaa ehdokkaita.</ng-container>
          <button type="button"
                  (click)="openFilters($event)" 
                  i18n="@@AVAASUODATIN">Avaa suodatinvalikko</button>
        </div>

        <div *ngIf="candidate.placeholderType == 'filterWarning'"
            class="filterWarning"
            [style.maxWidth]="cardWidth"
            [style.marginLeft]="marginLeft">
          <mat-icon>filter_list</mat-icon>
          <ng-container i18n>Listalta on suodatettu joitakin ehdokkaita.</ng-container>
          <button type="button"
                  (click)="openFilters($event)"
                  i18n="@@AVAASUODATIN">Avaa suodatinvalikko</button>
        </div>

        <div *ngIf="candidate.placeholderType == 'noResults'"
            class="filterWarning"
            [style.maxWidth]="cardWidth"
            [style.marginLeft]="marginLeft">
          <mat-icon>filter_list</mat-icon>
          <ng-container i18n>Suodattamisen jälkeen jäljelle ei jäänyt yhtään ehdokasta.</ng-container>
          <button type="button"
                  (click)="openFilters($event)"
                  i18n="@@AVAASUODATIN">Avaa suodatinvalikko</button>
        </div>

        <div *ngIf="candidate.placeholderType == 'noCandidates'"
            class="filterWarning"
            [style.maxWidth]="cardWidth"
            [style.marginLeft]="marginLeft">
          <mat-icon>filter_list</mat-icon>
          <ng-container i18n>Yksikään vaalipiirin ehdokkaista ei ole vastannut Kielivaalikoneen kysymyksiin.</ng-container>
          <button type="button"
                  (click)="returnHome()">Palaa alkuun</button>
        </div>

      </ng-container>

      <!-- Candidate -->

      <div *ngIf="!candidate.placeholderType"
          (click)="toggleCandidate(candidate, $event)"
          class="candidate"
          [class.active]="candidate.id == activeCandidateId"
          [class.filteredOut]="candidate.filteredOut"
          [style.maxWidth]="cardWidth"
          [style.marginLeft]="marginLeft">

        <div class="topRow">

          <!-- Top left column -->

          <img *ngIf="!candidate.filteredOut"
              class="portrait leftColumn"
              [src]="getPortraitUrl(candidate)"
              appFallbackImage />

          <!-- Top centre column -->

          <div class="centreColumn">

            <h2 class="name">{{ candidate.givenName }} {{ candidate.surname }}</h2>

            <div class="numberAndParty">

              <span class="party">
                <mat-icon class="party-{{ candidate.partyAbbreviation | toClassName }}">flag</mat-icon>
                {{ candidate.partyAbbreviation }}
              </span>

              <span class="number">
                {{ candidate.number }}
              </span>

            </div>

          </div>

          <!-- Top right column -->

          <div class="rightColumn">
            <div *ngIf="!voterDisabled"
                class="score">
              {{ candidate.score | percent }}
            </div>
            <mat-icon *ngIf="isFavourite(candidate) == false"
                      (click)="setFavourite(candidate, true, $event)"
                      i18n-title
                      i18n-aria-label
                      title="Lisää muistilistalle"
                      aria-label="Lisää muistilistalle -ikoni"
                      class="candidate-favourite candidate-favourite--isNotFavourite">star_border</mat-icon>
            <mat-icon *ngIf="isFavourite(candidate) == true"
                      (click)="setFavourite(candidate, false, $event)"
                      i18n-title
                      i18n-aria-label
                      title="Poista muistilistalta"
                      aria-label="Poista muistilistalta -ikoni"
                      class="candidate-favourite candidate-favourite--isFavourite">star</mat-icon>
          </div>

        </div>

        <!-- Bottom row -->

        <div class="disagreed topRow">

          <ng-container *ngIf="candidate.filteredOut">

            <label>
              <mat-icon>filter_list</mat-icon>
              <ng-container i18n>Ehdokas piilotettu suodattimien vuoksi</ng-container>
            </label>

          </ng-container>

          <ng-container *ngIf="!candidate.filteredOut">

            <div *ngIf="candidate.missing">

              <label>
                <mat-icon>warning</mat-icon>
                <ng-container i18n>Tämä ehdokas ei ole vastannut Ehdokaskartan kysymyksiin</ng-container>
              </label>
        
            </div>
        
            <ng-container *ngIf="!candidate.missing">

              <!-- <ng-container *ngIf="voterDisabled">

                <div *ngIf="themes[candidate.id]?.length > 0; else noThemes"
                      class="topicChipList">
                  <div *ngFor="let theme of themes[candidate.id]"
                        class="topicChip themeChip">
                    {{ theme }}
                  </div>
                </div>
                <ng-template #noThemes>
                  <div class="noThemes">Ei vastausta</div>
                </ng-template>
                <label>Aion puolustaa näitä asioita valtuutettuna</label>
        
              </ng-container> -->
        
              <ng-container *ngIf="!voterDisabled">
        
                <ng-container *ngIf="disagreed[candidate.id]?.length > 0">
                  
                  <div class="topicChipList">
                    <div *ngFor="let question of disagreed[candidate.id]"
                        class="topicChip customChip category-{{ question.categoryName | toClassName }}">
                      {{ question.topic }}
                    </div>
                  </div>
                  <label i18n>
                    Merkittävästi eri mieltä {{ disagreed[candidate.id]?.length }} kysymyksestä
                  </label>

                </ng-container>

                <div *ngIf="disagreed[candidate.id]?.length == 0">
                  <label i18n>
                    Ei kysymyksiä, joista olette merkittävästi eri mieltä
                  </label>
                </div>

              </ng-container>

            </ng-container>

          </ng-container>

        </div>

      </div>

    </ng-container>

</cdk-virtual-scroll-viewport>

<!-- Onboarding -->

<!-- <app-onboarding-tour tourId="ListIntro1"
                     [modal]="true">

  <app-onboarding-step attachTo="#topTools"
                       attachOn="bottom-end"
                       title="Listanäkymän lisätoiminnot">
    <p>
      Listalla ovat käytössä samat toiminnot kuin karttanäkymässäkin. Ne ovat vain aseteltu eri lailla.
    </p>
    <app-onboarding-hint icon="list">
      Pääset takaisin karttanäkymään klikkaamalla nappia uudelleen.
    </app-onboarding-hint>
    <app-onboarding-hint icon="filter_list">
      Jos olit jo suodattanut ehdokkaita kartalla, ovat samat suodattimet käytössä tässäkin näkymässä.
    </app-onboarding-hint>
  </app-onboarding-step>

</app-onboarding-tour> -->